{{ define "room" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Room - {{ .Room }}</title>
</head>
<body>
    <h1>Welcome, {{ .Username }} to room: {{ .Room }}</h1>

    <div id="timer">‚è≥ Countdown: ...</div>
    <div id="msg">Connecting to WebSocket...</div>
    <div id="winner">The Winner is...</div>
    <button onclick="sendSignal()">CLICK</button>
    <script>
        const roomName = "{{ .Room }}";
        const username = "{{ .Username }}";
        const socket = new WebSocket(
            (location.protocol === "https:" ? "wss://" : "ws://") +
            location.host +
            "/ws/" + roomName +
            "?username=" + encodeURIComponent(username)
        );
    
        socket.onopen = () => console.log("‚úÖ WebSocket connected");
        socket.onerror = (e) => console.error("‚ùå WebSocket error", e);
        socket.onclose = () => console.warn("‚ö†Ô∏è WebSocket closed");
    
        socket.onmessage = function (event) {
            const msg = JSON.parse(event.data);
    
            if (msg.type === "timer") {
                const t = document.getElementById("timer");
                if (msg.data > 0) {
                    t.innerText = `‚è≥ Countdown: ${msg.data}s`;
                } else {
                    t.innerText = "‚è∞ Time's up!";
                }
            } else if (msg.type === "user_count") {
                const m = document.getElementById("msg");
                m.innerHTML = `<b>Users in room:</b> ${msg.data}`;
            } else if (msg.type === "winner") {
                const m = document.getElementById("winner");
                m.innerText = `üèÜ The winner is: ${msg.data}`;
            }
        };
    
        function sendSignal() {
            socket.send(JSON.stringify({ type: "signal", data: "button_click" }));
        }
</script>
</body>
</html>
{{ end }}
